!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.gondel={})}(this,function(e){"use strict";var c=function(e,n,t){return t(e)},a=window.__gondelPluginEvents||{};function f(e,n,t,o){var r,i=!1;if((a[e]||c)(n,t,function(e){i=!0,r=o?o(e):e}),!i)throw new Error("Async plugin listener");return r}function n(e,i){a[e]||(a[e]=c);var n=a[e];a[e]=function(e,o,r){n(e,o,function(e,n,t){i(e,o,function(e){r(e,o,t)})})}}function m(e,n,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),c=t?u(t):n._ctx;if(e[0]!==n._namespace)throw new Error("Invalid event name '"+e+"' - use '"+n._namespace+e.charAt(0).toUpperCase()+e.slice(1)+"'");return i.initEvent(e,r,!0),i.data={component:n,name:n._componentName,namespace:n._namespace,eventData:o},c.dispatchEvent(i)}window.__gondelPluginEvents=a;var d=function(){},l=function(){var n=this;this.promise=new Promise(function(e){n.resolve=e})};function t(n,e,o){var t=Array.prototype.slice.call(e.querySelectorAll("[data-"+o+"-name]"));e.hasAttribute("data-"+o+"-name")&&t.push(e);var r=t.filter(function(e){return n=o,!e.hasOwnProperty("_gondelA_"+n);var n}),i=new l;r.forEach(function(e){var n,t;n=e,t=i.promise,n["_gondelA_"+o]=t});var c,a,s=f("boot",r,{namespace:o},function(e){return e.map(function(e){return function(e,n,t){var o=e.getAttribute("data-"+t+"-name"),r=n.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - "+o+" is not registred");var i=new r(e,o);return i._ctx=e,i._namespace=t,i._componentName=o,i.stop=function(e,n,t){m(t+"Stop",e,e._ctx),delete e._ctx["_gondel_"+t],delete e._ctx["_gondelA_"+t],e._stopped=!0,f("stop",e,{namespace:t},n.bind(e))}.bind(null,i,i.stop||d,t),e["_gondel_"+t]=i}(e,n,o)})}),u=(c=n,a={},s.forEach(function(e){return a[e._componentName]=!0}),Object.keys(a).filter(function(e){return!c._activeComponents[e]}));u.forEach(function(e){return n.setActiveState(e,!0)});var p=f("start",s,{newComponentNames:u,namespace:o,gondelComponentRegistry:n},function(e){return Promise.all(e.map(v))}).then(function(){return s.forEach(function(e){e.sync&&e.sync()}),f("sync",s,{namespace:o})});return p.then(i.resolve,i.resolve),p}function v(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(e,n){return t.start(e,n)})}var r=function(){function e(){this._components={},this._activeComponents={}}return e.prototype.registerComponent=function(e,n){this._components[e]=n},e.prototype.unregisterComponent=function(e){delete this._components[e]},e.prototype.getComponent=function(e){return this._components[e]},e.prototype.setActiveState=function(e,n){this._activeComponents[e]=n},e}(),i=window.__gondelRegistries=window.__gondelRegistries||{};function o(){var e=arguments,n=e[0],t="string"==typeof e[1]?e[1]:"g",o=e[e.length-1];i[t]||(i[t]=new r),i[t].getComponent(n)&&f("unregister",o,{componentName:n,namespace:t}),f("register",o,{componentName:n,namespace:t,gondelComponentRegistry:i[t]},function(e){i[t].registerComponent(n,e)})}function u(e){return void 0!==e.nodeType?e:e[0]}function p(e,n){void 0===n&&(n="g");var t=u(e)["_gondel_"+n];if(t&&t._ctx)return t}function s(e,n,t){void 0===e&&(e=document.documentElement),void 0===t&&(t="g");for(var o=[],r="_gondel_"+t,i=u(e).querySelectorAll("[data-"+t+"-name"+(n?'="'+n+'"':"")+"]"),c=0;c<i.length;c++){var a=i[c],s=a[r];s&&s._ctx===a&&o.push(s)}return o}var _={focus:"focusin",blur:"focusout"},g=window.__gondelDomEvents||{};window.__gondelDomEvents=g;var h=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function y(e,n,t,o){!function(e,n,t){for(var o=[],r=0;r<e.length&&!n.cancelBubble;r++){var i=e[r],c=i.handlerOptions,a=p(i.ctx,t);if(a)for(var s=0;s<c.length&&!n.cancelBubble;s++){var u=a[c[s].handlerName].call(a,n);"function"==typeof u&&o.push(u)}}o.forEach(function(e){e()})}(function(r,i,e){var c=function(e){for(var n=[],t=e;t;t=t.parentElement)n.push(t);return n}(e),a=[];c.forEach(function(e,n){var t=e.getAttribute(r),o=t&&i[t];o&&a.push({index:n,handlers:o})});var s=[];return a.forEach(function(e){var t=e.index,o=e.handlers;Object.keys(o).forEach(function(e){if(!e)return s.push({index:t,ctx:c[t],handlerOptions:o[e]});for(var n=t;0<=--n;)if(h.call(c[n],e))return s.push({index:n,ctx:c[t],handlerOptions:o[e]})})}),0===s.length?[]:(s.sort(function(e,n){return e.index>n.index?1:e.index===n.index?0:-1}),s)}(n,t,o.target),o,e)}function E(e){return g[e]||(g[e]={}),g[e]}function w(o,r,e,n,t){var i=E(o);i[r]||(i[r]={},f("registerEvent",!0,{eventName:r,namespace:o,eventRegistry:i[r]},function(e){var n,t;e&&(n=r,t=o,document.documentElement.addEventListener(_[n]||n,y.bind(null,t,"data-"+t+"-name",g[t][n])))})),i[r][e]||(i[r][e]={});var c=("object"==typeof t?t:{selector:t}).selector||"";i[r][e][c]||(i[r][e][c]=[]),i[r][e][c].push(Object.assign({handlerName:n,handlerOption:t}))}var C=!1;function b(){C=!0,n("register",function(e,n,t){var o=n.componentName,r=n.namespace;if(!n.gondelComponentRegistry._activeComponents[o])return t(e);var i=e.prototype&&e.prototype.__events||e.__events;i&&i.forEach(function(e){w(r,e[0],o,e[1],e[2])}),t(e)}),n("unregister",function(e,n,t){var o=n.componentName;!function(e,n){var t=E(e);for(var o in t)t.hasOwnProperty(o)&&delete t[o][n]}(n.namespace,o),t(e)}),n("start",function(e,n,t){var o=n.newComponentNames,r=n.gondelComponentRegistry,i=n.namespace;o.forEach(function(n){var e=r.getComponent(n),t=e.prototype&&e.prototype.__events||e.__events;t&&t.forEach(function(e){w(i,e[0],n,e[1],e[2])})});t(e)})}var x=function(){};e.addGondelPluginEventListener=n,e.registerComponent=o,e.getFirstDomNode=u,e.startComponents=function(e,n){return void 0===n&&(n="g"),i[n]?t(i[n],e?u(e):document.documentElement,n):Promise.resolve([])},e.stopComponents=function(e,n){void 0===n&&(n="g");var t=s(e,void 0,n),o=e&&p(e);o&&t.unshift(o),t.forEach(function(e){return e.stop()})},e.getComponentByDomNode=p,e.getComponentByDomNodeAsync=function(e,n){void 0===n&&(n="g");var t=u(e),o=t["_gondelA_"+n];return o?o._ctx?Promise.resolve(o):o.then(function(){return t["_gondel_"+n]}):Promise.reject(void 0)},e.findComponents=s,e.Component=function(n,t){return function(e){o(n,t,e)}},e.EventListener=function(t,o){return function(e,n){if(C||b(),"_"!==n.substr(0,1))throw new Error("Invalid handler name '"+n+"' use '_"+n+"' instead.");e.__events||(e.__events=[]),e.__events.push([t,n,o])}},e.triggerPublicEvent=m,e.GondelBaseComponent=x,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
