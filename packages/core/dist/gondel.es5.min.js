!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.gondel={})}(this,function(n){"use strict";var c=function(n,t,e){return e(n)},a=window.__gondelPluginEvents||{};function p(n,t,e,o){var r,i=!1;if((a[n]||c)(t,e,function(n){i=!0,r=o?o(n):n}),!i)throw new Error("Async plugin listener (https://git.io/f4Dor)");return r}function t(n,i){a[n]||(a[n]=c);var t=a[n];a[n]=function(n,o,r){t(n,o,function(n,t,e){i(n,o,function(n){r(n,o,e)})})}}function m(n,t,e,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),c=e?f(e):t._ctx;if(n[0]!==t._namespace)throw new Error("Invalid event name "+n+" (https://git.io/f4Drw)");return i.initEvent(n,r,!0),i.data={component:t,name:t._componentName,namespace:t._namespace,eventData:o},c.dispatchEvent(i)}window.__gondelPluginEvents=a;var d=function(){},v=function(){var t=this;this.promise=new Promise(function(n){t.resolve=n})};function e(t,n,o){var e=Array.prototype.slice.call(n.querySelectorAll("[data-"+o+"-name]"));n.hasAttribute("data-"+o+"-name")&&e.push(n);var r=e.filter(function(n){return t=o,!n.hasOwnProperty(h(t,"async"));var t}),i=new v;r.forEach(function(n){var t,e;t=n,e=i.promise,t[h(o,"async")]=e});var c,a,s=p("boot",r,{namespace:o},function(n){return n.map(function(n){return function(n,t,e){var o=n.getAttribute("data-"+e+"-name"),r=t.getComponent(o);if(void 0===r)throw new Error("Boot failed, "+o+" not registered (https://git.io/f4D4G).");var i=new r(n,o);return i._ctx=n,i._namespace=e,i._componentName=r.__identification[e],i.stop=function(n,t,e){m(e+"Stop",n,n._ctx),delete n._ctx[h(e)],delete n._ctx[h(e,"async")],n._stopped=!0,p("stop",n,{namespace:e},t.bind(n))}.bind(null,i,i.stop||d,e),n[h(e)]=i}(n,t,o)})}),u=(c=t,a={},s.forEach(function(n){return a[n._componentName]=!0}),Object.keys(a).filter(function(n){return!c._activeComponents[n]}));u.forEach(function(n){return t.setActiveState(n,!0)});var f=p("start",s,{newComponentNames:u,namespace:o,gondelComponentRegistry:t},function(n){return Promise.all(n.map(l))}).then(function(){return s.forEach(function(n){n.sync&&n.sync()}),p("sync",s,{namespace:o})});return f.then(i.resolve,i.resolve),f}function l(e){if(e.start)return 0===e.start.length?e.start():new Promise(function(n,t){return e.start(n,t)})}var r=function(){function n(){this._components={},this._activeComponents={}}return n.prototype.registerComponent=function(n,t){this._components[n]=t},n.prototype.unregisterComponent=function(n){delete this._components[n]},n.prototype.getComponent=function(n){return this._components[n]},n.prototype.setActiveState=function(n,t){this._activeComponents[n]=t},n}(),i=window.__gondelRegistries=window.__gondelRegistries||{};function o(t,n,e){void 0===e&&(e="g");var o=n;o.hasOwnProperty("__identification")||(o.__identification={}),o.__identification[e]=t,i[e]||(i[e]=new r),i[e].getComponent(t)&&p("unregister",n,{componentName:t,namespace:e}),p("register",n,{componentName:t,namespace:e,gondelComponentRegistry:i[e]},function(n){i[e].registerComponent(t,o)})}function h(n,t){void 0===n&&(n="g");var e="__gondel_"+(t?t+"_":"")+n+"__";return Symbol&&"function"==typeof Symbol.for?Symbol.for(e):e}function f(n){return void 0!==n.nodeType?n:n[0]}function _(n,t){void 0===t&&(t="g");var e=f(n)[h(t)];if(e&&e._ctx)return e;throw new Error("Component not found in DOM (https://git.io/f4D44).")}function s(n,t,e){void 0===n&&(n=document.documentElement),void 0===e&&(e="g");for(var o=f(n),r=[],i=h(e),c=o.querySelectorAll("[data-"+e+"-name"+(t?'="'+("string"==typeof t?t:function(n,t){if(!n.__identification)throw new Error("Unregistered component has no identifier (https://git.io/f4DKv)");var e=n.__identification;if(!e[t])throw new Error("No component for '"+t+"' (https://git.io/f4DKf)");return e[t]}(t,e))+'"':"")+"]"),a=0;a<c.length;a++){var s=c[a],u=s[i];u&&u._ctx===s&&r.push(u)}return r}var u={focus:"focusin",blur:"focusout"},g=window.__gondelDomEvents||{};window.__gondelDomEvents=g;var y=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function E(n,t,e,o){!function(n,t,e){for(var o=[],r=0;r<n.length&&!t.cancelBubble;r++){var i=n[r],c=i.handlerOptions,a=_(i.ctx,e);if(a)for(var s=0;s<c.length&&!t.cancelBubble;s++){var u=a[c[s].handlerName].call(a,t);"function"==typeof u&&o.push(u)}}o.forEach(function(n){n()})}(function(r,i,n){var c=function(n){for(var t=[],e=n;e;e=e.parentElement)t.push(e);return t}(n),a=[];c.forEach(function(n,t){var e=n.getAttribute(r),o=e&&i[e];o&&a.push({index:t,handlers:o})});var s=[];return a.forEach(function(n){var e=n.index,o=n.handlers;Object.keys(o).forEach(function(n){if(!n)return s.push({index:e,ctx:c[e],handlerOptions:o[n]});for(var t=e;0<=--t;)if(y.call(c[t],n))return s.push({index:t,ctx:c[e],handlerOptions:o[n]})})}),0===s.length?[]:(s.sort(function(n,t){return n.index>t.index?1:n.index===t.index?0:-1}),s)}(t,e,o.target),o,n)}function w(n){return g[n]||(g[n]={}),g[n]}function C(o,r,n,t,e){var i=w(o);i[r]||(i[r]={},p("registerEvent",!0,{eventName:r,namespace:o,eventRegistry:i[r]},function(n){var t,e;n&&(t=r,e=o,document.documentElement.addEventListener(u[t]||t,E.bind(null,e,"data-"+e+"-name",g[e][t])))})),i[r][n]||(i[r][n]={});var c=("object"==typeof e?e:{selector:e}).selector||"";i[r][n][c]||(i[r][n][c]=[]),i[r][n][c].push(Object.assign({handlerName:t,handlerOption:e}))}var b=!1;function x(){b=!0,t("register",function(n,t,e){var o=t.componentName,r=t.namespace;if(!t.gondelComponentRegistry._activeComponents[o])return e(n);var i=n.prototype&&n.prototype.__events||n.__events;i&&i.forEach(function(n){C(r,n[0],o,n[1],n[2])}),e(n)}),t("unregister",function(n,t,e){var o=t.componentName;!function(n,t){var e=w(n);for(var o in e)e.hasOwnProperty(o)&&delete e[o][t]}(t.namespace,o),e(n)}),t("start",function(n,t,e){var o=t.newComponentNames,r=t.gondelComponentRegistry,i=t.namespace;o.forEach(function(t){var n=r.getComponent(t),e=n.prototype&&n.prototype.__events||n.__events;e&&e.forEach(function(n){C(i,n[0],t,n[1],n[2])})});e(n)})}var N=function(){function n(){}return n.prototype.stop=function(){},n.__identification={},n}();n.addGondelPluginEventListener=t,n.registerComponent=o,n.getGondelAttribute=h,n.getFirstDomNode=f,n.startComponents=function(n,t){return void 0===t&&(t="g"),i[t]?e(i[t],n?f(n):document.documentElement,t):Promise.resolve([])},n.stopComponents=function(n,t){void 0===t&&(t="g");var e=s(n,void 0,t),o=n&&_(n);o&&e.unshift(o),e.forEach(function(n){return n.stop()})},n.isComponentMounted=function(n,t){void 0===t&&(t="g");var e=f(n)[h(t)];return e&&e._ctx},n.getComponentByDomNode=_,n.getComponentByDomNodeAsync=function(n,t){void 0===t&&(t="g");var e=f(n),o=e[h(t,"async")];return o?o._ctx?Promise.resolve(o):o.then(function(){return e[h(t)]}):Promise.reject(void 0)},n.findComponents=s,n.Component=function(t,e){return void 0===e&&(e="g"),function(n){o(t,n,e)}},n.EventListener=function(e,o){return function(n,t){if(b||x(),"_"!==t.substr(0,1))throw new Error("Invalid handler name, use '_' prefix (https://git.io/f4D4a).");n.__events||(n.__events=[]),n.__events.push([e,t,o])}},n.triggerPublicEvent=m,n.GondelBaseComponent=N,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
