!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.gondel={})}(this,function(e){"use strict";var c=function(e,n,t){return t(e)},a=window.__gondelPluginEvents||{};function f(e,n,t,o){var r,i=!1;if((a[e]||c)(n,t,function(e){i=!0,r=o?o(e):e}),!i)throw new Error("Async plugin listener");return r}function n(e,i){a[e]||(a[e]=c);var n=a[e];a[e]=function(e,o,r){n(e,o,function(e,n,t){i(e,o,function(e){r(e,o,t)})})}}function m(e,n,t,o,r){void 0===o&&(o={}),void 0===r&&(r=!0);var i=document.createEvent("Event"),c=t?p(t):n._ctx;if(e[0]!==n._namespace)throw new Error("Invalid event name '"+e+"' - use '"+n._namespace+e.charAt(0).toUpperCase()+e.slice(1)+"'");return i.initEvent(e,r,!0),i.data={component:n,name:n._componentName,namespace:n._namespace,eventData:o},c.dispatchEvent(i)}window.__gondelPluginEvents=a;var d=function(){},l=function(){var n=this;this.promise=new Promise(function(e){n.resolve=e})};function t(n,e,o){var t=Array.prototype.slice.call(e.querySelectorAll("[data-"+o+"-name]"));e.hasAttribute("data-"+o+"-name")&&t.push(e);var r=t.filter(function(e){return n=o,!e.hasOwnProperty(h(n,"async"));var n}),i=new l;r.forEach(function(e){var n,t;n=e,t=i.promise,n[h(o,"async")]=t});var c,a,s=f("boot",r,{namespace:o},function(e){return e.map(function(e){return function(e,n,t){var o=e.getAttribute("data-"+t+"-name"),r=n.getComponent(o);if(void 0===r)throw new Error("Failed to boot component - "+o+" is not registred");var i=new r(e,o);return i._ctx=e,i._namespace=t,i._componentName=r.componentName,i.stop=function(e,n,t){m(t+"Stop",e,e._ctx),delete e._ctx[h(t)],delete e._ctx[h(t,"async")],e._stopped=!0,f("stop",e,{namespace:t},n.bind(e))}.bind(null,i,i.stop||d,t),e[h(t)]=i}(e,n,o)})}),u=(c=n,a={},s.forEach(function(e){return a[e._componentName]=!0}),Object.keys(a).filter(function(e){return!c._activeComponents[e]}));u.forEach(function(e){return n.setActiveState(e,!0)});var p=f("start",s,{newComponentNames:u,namespace:o,gondelComponentRegistry:n},function(e){return Promise.all(e.map(v))}).then(function(){return s.forEach(function(e){e.sync&&e.sync()}),f("sync",s,{namespace:o})});return p.then(i.resolve,i.resolve),p}function v(t){if(t.start)return 0===t.start.length?t.start():new Promise(function(e,n){return t.start(e,n)})}var o=function(){function e(){this._components={},this._activeComponents={}}return e.prototype.registerComponent=function(e,n){this._components[e]=n},e.prototype.unregisterComponent=function(e){delete this._components[e]},e.prototype.getComponent=function(e){return this._components[e]},e.prototype.setActiveState=function(e,n){this._activeComponents[e]=n},e}(),r=window.__gondelRegistries=window.__gondelRegistries||{};function i(e,n){void 0===n&&(n="g");var t=e.componentName;r[n]||(r[n]=new o),r[n].getComponent(t)&&f("unregister",e,{componentName:t,namespace:n}),f("register",e,{componentName:t,namespace:n,gondelComponentRegistry:r[n]},function(e){r[n].registerComponent(t,e)})}function h(e,n){void 0===e&&(e="g");var t="__gondel_"+(n?n+"_":"")+e+"__";return Symbol&&"function"==typeof Symbol.for?Symbol.for(t):t}function p(e){return void 0!==e.nodeType?e:e[0]}function g(e,n){void 0===n&&(n="g");var t=p(e)[h(n)];if(t&&t._ctx)return t}function s(e,n,t){void 0===e&&(e=document.documentElement),void 0===t&&(t="g");for(var o=p(e),r=[],i=h(t),c=o.querySelectorAll("[data-"+t+"-name"+(n?'="'+n.componentName+'"':"")+"]"),a=0;a<c.length;a++){var s=c[a],u=s[i];u&&u._ctx===s&&r.push(u)}return r}var u={focus:"focusin",blur:"focusout"},_=window.__gondelDomEvents||{};window.__gondelDomEvents=_;var y=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function E(e,n,t,o){!function(e,n,t){for(var o=[],r=0;r<e.length&&!n.cancelBubble;r++){var i=e[r],c=i.handlerOptions,a=g(i.ctx,t);if(a)for(var s=0;s<c.length&&!n.cancelBubble;s++){var u=a[c[s].handlerName].call(a,n);"function"==typeof u&&o.push(u)}}o.forEach(function(e){e()})}(function(r,i,e){var c=function(e){for(var n=[],t=e;t;t=t.parentElement)n.push(t);return n}(e),a=[];c.forEach(function(e,n){var t=e.getAttribute(r),o=t&&i[t];o&&a.push({index:n,handlers:o})});var s=[];return a.forEach(function(e){var t=e.index,o=e.handlers;Object.keys(o).forEach(function(e){if(!e)return s.push({index:t,ctx:c[t],handlerOptions:o[e]});for(var n=t;0<=--n;)if(y.call(c[n],e))return s.push({index:n,ctx:c[t],handlerOptions:o[e]})})}),0===s.length?[]:(s.sort(function(e,n){return e.index>n.index?1:e.index===n.index?0:-1}),s)}(n,t,o.target),o,e)}function w(e){return _[e]||(_[e]={}),_[e]}function C(o,r,e,n,t){var i=w(o);i[r]||(i[r]={},f("registerEvent",!0,{eventName:r,namespace:o,eventRegistry:i[r]},function(e){var n,t;e&&(n=r,t=o,document.documentElement.addEventListener(u[n]||n,E.bind(null,t,"data-"+t+"-name",_[t][n])))})),i[r][e]||(i[r][e]={});var c=("object"==typeof t?t:{selector:t}).selector||"";i[r][e][c]||(i[r][e][c]=[]),i[r][e][c].push(Object.assign({handlerName:n,handlerOption:t}))}var b=!1;function x(){b=!0,n("register",function(e,n,t){var o=n.componentName,r=n.namespace;if(!n.gondelComponentRegistry._activeComponents[o])return t(e);var i=e.prototype&&e.prototype.__events||e.__events;i&&i.forEach(function(e){C(r,e[0],o,e[1],e[2])}),t(e)}),n("unregister",function(e,n,t){var o=n.componentName;!function(e,n){var t=w(e);for(var o in t)t.hasOwnProperty(o)&&delete t[o][n]}(n.namespace,o),t(e)}),n("start",function(e,n,t){var o=n.newComponentNames,r=n.gondelComponentRegistry,i=n.namespace;o.forEach(function(n){var e=r.getComponent(n),t=e.prototype&&e.prototype.__events||e.__events;t&&t.forEach(function(e){C(i,e[0],n,e[1],e[2])})});t(e)})}var N=function(){function e(){}return e.prototype.stop=function(){},e}();e.addGondelPluginEventListener=n,e.registerComponent=i,e.getGondelAttribute=h,e.getFirstDomNode=p,e.startComponents=function(e,n){return void 0===n&&(n="g"),r[n]?t(r[n],e?p(e):document.documentElement,n):Promise.resolve([])},e.stopComponents=function(e,n){void 0===n&&(n="g");var t=s(e,void 0,n),o=e&&g(e);o&&t.unshift(o),t.forEach(function(e){return e.stop()})},e.getComponentByDomNode=g,e.getComponentByDomNodeAsync=function(e,n){void 0===n&&(n="g");var t=p(e),o=t[h(n,"async")];return o?o._ctx?Promise.resolve(o):o.then(function(){return t[h(n)]}):Promise.reject(void 0)},e.findComponents=s,e.Component=function(e,n){return function(e){if(!e.componentName)throw new Error("Could not register component, check if "+e.name+".componentName is defined.");i(e,n)}},e.EventListener=function(t,o){return function(e,n){if(b||x(),"_"!==n.substr(0,1))throw new Error("Invalid handler name '"+n+"' use '_"+n+"' instead.");e.__events||(e.__events=[]),e.__events.push([t,n,o])}},e.triggerPublicEvent=m,e.GondelBaseComponent=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gondel.es5.min.js.map
